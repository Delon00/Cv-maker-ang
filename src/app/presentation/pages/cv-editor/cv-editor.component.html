<app-navbar></app-navbar>
<main class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- Formulaire -->
    <section class="">
        <form [formGroup]="formCvSimple" (ngSubmit)="onSave()">
            <div class="flex justify-between w-full gap-2">

                <!-- Nom -->
                <div class="mb-4 w-full">
                    <label for="lastName" class="block mb-1 font-semibold">Nom</label>
                    <input type="text" id="lastName" formControlName="lastName" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('lastName')?.touched && formCvSimple.get('lastName')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">{{ formErrors['lastName'] || 'Champ invalide.' }}</p>
                    }
                </div>

                <!-- Prénom -->
                <div class="mb-4  w-full">
                    <label for="firstName" class="block mb-1 font-semibold">Prénom</label>
                    <input type="text" id="firstName" formControlName="firstName" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('firstName')?.touched && formCvSimple.get('firstName')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">
                            {{ formErrors['firstName'] || 'Champ invalide.' }}
                        </p>
                    }
                </div>
            </div>

            <div class="flex justify-between w-full gap-2">
                <!-- Email -->
                <div class="mb-4 w-full">
                    <label for="email" class="block mb-1 font-semibold">Email</label>
                    <input type="email" id="email" formControlName="email" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('email')?.touched && formCvSimple.get('email')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">
                            {{ formErrors['email'] || 'Champ invalide.' }}
                        </p>
                    }
                </div>

                <!-- Téléphone -->
                <div class="mb-4 w-full">
                    <label for="phone" class="block mb-1 font-semibold">Téléphone</label>
                    <input type="text" id="phone" formControlName="phone" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('phone')?.touched && formCvSimple.get('phone')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">
                            {{ formErrors['phone'] || 'Champ invalide.' }}
                        </p>
                    }
                </div>
            </div>

            <div class="flex justify-between w-full gap-2">
                <!-- Titre -->
                <div class="mb-4 w-full">
                    <label for="title" class="block mb-1 font-semibold">Titre professionnel</label>
                    <input type="text" id="title" formControlName="title" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('title')?.touched && formCvSimple.get('title')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">{{ formErrors['title'] || 'Champ invalide.' }}</p>
                    }
                </div>

                <!-- Ville -->
                <div class="mb-4 w-full">
                    <label for="city" class="block mb-1 font-semibold">Ville</label>
                    <input type="text" id="city" formControlName="city" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('city')?.touched && formCvSimple.get('city')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">{{ formErrors['city'] || 'Champ invalide.' }}</p>
                    }
                </div>
            </div>


            <!-- Profil Professionnel -->
            <div class="mb-4">
                <label for="profile" class="block mb-1 font-semibold">Profil Professionnel</label>
                <textarea id="profile" formControlName="profile" class="border p-2 w-full rounded"></textarea>
                @if (formCvSimple.get('profile')?.touched && formCvSimple.get('profile')?.invalid) {
                    <p class="text-red-500 text-sm mt-1">{{ formErrors['profile'] || 'Champ invalide.' }}</p>
                }
            </div>

            <!-- Expériences Professionnelles -->
            <div class="mb-4">
                <h3 class="block mb-1 font-semibold">Expériences Professionnelles</h3>
                <div formArrayName="experiences">
                    @for (exp of experiences.controls; track i; let i = $index) {
                        <div [formGroupName]="i" class="mb-4 border p-4 rounded">
                            <div class="mb-2">
                                <label for="exp-title">Titre</label>
                                <input type="text" id="exp-title" formControlName="title" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label for="exp-location">Lieu</label>
                                <input type="text" id="exp-location" formControlName="location" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label for="exp-date">Date</label>
                                <input type="text" id="exp-date" formControlName="date" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label for="exp-missions">Missions</label>
                                <textarea id="exp-missions" formControlName="missions" class="border p-2 w-full rounded"></textarea>
                            </div>
                        </div>
                    }
                </div>
                <button type="button" (click)="addExperience()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Ajouter une expérience</button>
            </div>





            <!-- Centres d'intérêt -->
            <div class="mb-4">
                <label for="interests" class="block mb-1 font-semibold">Centres d'intérêt</label>
                <textarea id="interests" formControlName="interests" class="border p-2 w-full rounded"></textarea>
            </div>

            <!-- Réseaux Sociaux -->
            <div class="mb-4">
                <label for="linkedin" class="block mb-1 font-semibold">LinkedIn</label>
                <input type="text" id="linkedin" formControlName="linkedin" class="border p-2 w-full rounded">
            </div>



            <!-- Bouton de soumission -->
            <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
                Sauvegarder le CV
            </button>
        </form>
    </section>

    <!-- Aperçu du Template -->
    <section class="border rounded p-4 ">
        <h2 class="text-xl font-bold mb-4">Preview du template {{ templateName }}</h2>
        @if (componentToRender) {
            <ng-container *ngComponentOutlet="componentToRender; inputs: previewData"></ng-container>
        } @else {
            <p class="text-red-500">Aucun template trouvé pour cet ID.</p>
        }
    </section>
</main>
