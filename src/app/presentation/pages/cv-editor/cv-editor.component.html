<app-navbar></app-navbar>
<main class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- Formulaire -->
    <section class="form-container">
        <form [formGroup]="formCvSimple" (ngSubmit)="onSave()">
            <div class="flex justify-between w-full gap-2">

                <!-- Nom -->
                <div class="mb-4 w-full">
                    <label  for="lastName" class="block mb-1 font-semibold">Nom</label>
                    <input type="text" id="lastName" formControlName="lastName" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('lastName')?.touched && formCvSimple.get('lastName')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">{{ formErrors['lastName'] || 'Champ invalide.' }}</p>
                    }
                </div>

                <!-- Prénom -->
                <div class="mb-4  w-full">
                    <label  for="firstName" class="block mb-1 font-semibold">Prénom</label>
                    <input type="text" id="firstName" formControlName="firstName" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('firstName')?.touched && formCvSimple.get('firstName')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">
                            {{ formErrors['firstName'] || 'Champ invalide.' }}
                        </p>
                    }
                </div>
            </div>

            <div class="flex justify-between w-full gap-2">
                <!-- Email -->
                <div class="mb-4 w-full">
                    <label  for="email" class="block mb-1 font-semibold">Email</label>
                    <input type="email" id="email" formControlName="email" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('email')?.touched && formCvSimple.get('email')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">
                            {{ formErrors['email'] || 'Champ invalide.' }}
                        </p>
                    }
                </div>

                <!-- Téléphone -->
                <div class="mb-4 w-full">
                    <label  for="phone" class="block mb-1 font-semibold">Téléphone</label>
                    <input type="text" id="phone" formControlName="phone" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('phone')?.touched && formCvSimple.get('phone')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">
                            {{ formErrors['phone'] || 'Champ invalide.' }}
                        </p>
                    }
                </div>
            </div>

            <div class="flex justify-between w-full gap-2">
                <!-- Titre -->
                <div class="mb-4 w-full">
                    <label  for="title" class="block mb-1 font-semibold">Titre professionnel</label>
                    <input type="text" id="title" formControlName="title" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('title')?.touched && formCvSimple.get('title')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">{{ formErrors['title'] || 'Champ invalide.' }}</p>
                    }
                </div>

                <!-- Ville -->
                <div class="mb-4 w-full">
                    <label  for="city" class="block mb-1 font-semibold">Ville</label>
                    <input type="text" id="city" formControlName="city" class="border p-2 w-full rounded">
                    @if (formCvSimple.get('city')?.touched && formCvSimple.get('city')?.invalid) {
                        <p class="text-red-500 text-sm mt-1">{{ formErrors['city'] || 'Champ invalide.' }}</p>
                    }
                </div>
            </div>


            <!-- Profil Professionnel -->
            <div class="mb-4">
                <label  for="profile" class="block mb-1 font-semibold">Profil Professionnel</label>
                <textarea id="profile" formControlName="profile" class="border p-2 w-full rounded"></textarea>
                @if (formCvSimple.get('profile')?.touched && formCvSimple.get('profile')?.invalid) {
                    <p class="text-red-500 text-sm mt-1">{{ formErrors['profile'] || 'Champ invalide.' }}</p>
                }
            </div>

            <!-- Expériences Professionnelles -->
            <div class="mb-4 ">
                <h3 class="block mb-1 text-black font-semibold">Expériences Professionnelles</h3>
                <div formArrayName="experiences">
                    @for (exp of experiences.controls; track i; let i = $index) {
                        <div [formGroupName]="i" class="relative mb-4 border pt-8 p-4 border-input-color">
                            <div class="mb-2">
                                <label  for="exp-title">Titre</label>
                                <input type="text" id="exp-title" formControlName="title" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="exp-location">Lieu</label>
                                <input type="text" id="exp-location" formControlName="location" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="exp-startDate">Date de début</label>
                                <input type="date" id="exp-startDate" formControlName="startDate" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="exp-endDate">Date de fin</label>
                                <input type="date" id="exp-endDate" formControlName="endDate" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="exp-missions">Missions</label>
                                <textarea id="exp-missions" formControlName="missions" class="border p-2 w-full rounded"></textarea>
                            </div>
                            <button type="button" (click)="removeExperience(i)" class="trash absolute top-2 right-2 mb-2 text-red-500 hover:underline"><i class="pi pi-trash" style="color: red"></i></button>
                        </div>

                    }
                </div>
                <button type="button" (click)="addExperience()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Ajouter une expérience</button>
            </div>

            <!-- Formation -->
            <div class="mb-4 ">
                <h3 class="block mb-1 text-black font-semibold">Formation</h3>
                <div formArrayName="experiences">
                    @for (exp of educations.controls; track i; let i = $index) {
                        <div [formGroupName]="i" class="relative mb-4 border p-4 border-input-color">
                            <div class="mb-2">
                                <label  for="edu-school">Établissement</label>
                                <input type="text" id="edu-school" formControlName="school" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="edu-location">Lieu</label>
                                <input type="text" id="edu-location" formControlName="location" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="edu-field">Titre de formation</label>
                                <input id="edu-field" formControlName="field" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="edu-startDate">Année de début</label>
                                <input type="text" id="edu-startDate" formControlName="startDate" class="border p-2 w-full rounded">
                            </div>
                            <div class="mb-2">
                                <label  for="edu-startDate">Année de fin</label>
                                <input type="text" id="edu-startDate" formControlName="startDate" class="border p-2 w-full rounded">
                            </div>
                            <button type="button" (click)="removeEducation(i)" class="trash absolute top-2 right-2 mb-2 text-red-500 hover:underline"><i class="pi pi-trash" style="color: red"></i></button>
                        </div>
                    }
                </div>
                <button type="button" (click)="addEducation()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Ajouter une formation</button>
            </div>

            <!-- Langues -->
            <div class="mb-4">
                <h3 class="text-black font-semibold mb-2">Langues</h3>
                <div formArrayName="languages">
                    @for (lang of languages.controls; track i; let i = $index) {
                    <div [formGroupName]="i" class="relative mb-2 border p-4 border-input-color">
                        <label for="name">Langue</label>
                        <input id="name" formControlName="name" type="text" class="border p-2 w-full rounded mb-2">

                        <label for="level">Niveau</label>
                        <input id="level" formControlName="level" type="text" class="border p-2 w-full rounded">
                        <button type="button" (click)="removeLanguage(i)" class="trash absolute top-2 right-2 mb-2 text-red-500 hover:underline"><i class="pi pi-trash" style="color: red"></i></button>
                    </div>
                    }
                </div>
                <button type="button" (click)="addLanguage()" class="bg-blue-500 text-white px-4 py-2 rounded mt-2">Ajouter une langue</button>
            </div>


            <div class="mb-4">
                <h3 class="text-black font-semibold mb-2">Certifications</h3>
                <div formArrayName="certifications">
                    @for (cert of certifications.controls; track i; let i = $index) {
                    <div [formGroupName]="i" class="relative mb-2 border p-4 border-input-color">
                        <label for="title">Titre</label>
                        <input id="title" formControlName="title" type="text" class="border p-2 w-full rounded mb-2">

                        <label for="institution">Institution</label>
                        <input id="institution" formControlName="institution" type="text" class="border p-2 w-full rounded mb-2">

                        <label for="date">Date d'obtention</label>
                        <input id="date" formControlName="date" type="date" class="border p-2 w-full rounded">
                        <button type="button" (click)="removeCertification(i)" class="trash absolute top-2 right-2 mb-2 text-red-500 hover:underline"><i class="pi pi-trash" style="color: red"></i></button>
                    </div>
                    }
                </div>
                <button type="button" (click)="addCertification()" class="bg-blue-500 text-white px-4 py-2 rounded mt-2">Ajouter une certification</button>
            </div>







            <!-- Centres d'intérêt -->
            <div class="mb-4">
                <label  for="interests" class="block mb-1 font-semibold">Centres d'intérêt</label>
                <textarea id="interests" formControlName="interests" class="border p-2 w-full rounded"></textarea>
            </div>

            <!-- Réseaux Sociaux -->
            <div class="mb-4">
                <label  for="linkedin" class="block mb-1 font-semibold">LinkedIn</label>
                <input type="text" id="linkedin" formControlName="linkedin" class="border p-2 w-full rounded">
            </div>




            <!-- Bouton de soumission -->
            <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
                Sauvegarder le CV
            </button>
        </form>
    </section>

    <!-- Aperçu du Template -->
    <section class="border rounded p-4 ">
        <h2 class="text-xl font-bold mb-4">Preview du template {{ templateName }}</h2>
        @if (componentToRender) {
            <ng-container *ngComponentOutlet="componentToRender; inputs: previewData"></ng-container>
        } @else {
            <p class="text-red-500">Aucun template trouvé pour cet ID.</p>
        }
    </section>
</main>
